---
description: Regras de desenvolvimento DataHawks - Clean Code, RefatoraÃ§Ã£o e Qualidade
globs: ["**/*.ts", "**/*.js", "**/*.json", "**/*.yaml", "**/*.yml"]
alwaysApply: true
---

# ğŸ¦… DataHawks Development Rules

## ğŸ¯ PrincÃ­pios Fundamentais

### **1. Clean Code First**
- **Nomes descritivos**: VariÃ¡veis, funÃ§Ãµes e classes devem expressar intenÃ§Ã£o
- **FunÃ§Ãµes pequenas**: MÃ¡ximo 20 linhas, idealmente 10
- **Classes coesas**: MÃ¡ximo 600 linhas, refatorar quando atingir 400
- **DRY (Don't Repeat Yourself)**: Reaproveitar cÃ³digo via composiÃ§Ã£o e heranÃ§a

### **2. TypeScript Strict Mode**
```typescript
// âœ… BOM
interface ValidationResult {
  isValid: boolean;
  errors: string[];
  metadata?: Record<string, unknown>;
}

// âŒ RUIM
type Result = any;
```

### **3. RefatoraÃ§Ã£o AutomÃ¡tica**
- **Trigger**: Arquivo > 600 linhas
- **AÃ§Ã£o**: Sugerir extraÃ§Ã£o de mÃ³dulos
- **CritÃ©rios**: 
  - Identificar responsabilidades Ãºnicas
  - Criar interfaces claras
  - Manter testes passando

## ğŸ—ï¸ Arquitetura & Patterns

### **Clean Architecture Layers**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Controllers   â”‚ â† Handlers HTTP/API
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚    Use Cases    â”‚ â† LÃ³gica de negÃ³cio
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Repositories  â”‚ â† Acesso a dados
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Entities    â”‚ â† Modelos de domÃ­nio
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### **Design Patterns ObrigatÃ³rios**
- **Factory**: Para criaÃ§Ã£o de objetos complexos
- **Strategy**: Para algoritmos intercambiÃ¡veis
- **Observer**: Para eventos e logs
- **Repository**: Para acesso a dados

## ğŸ§ª Qualidade & Testes

### **TDD Cycle**
1. **Red**: Escrever teste falhando
2. **Green**: Implementar cÃ³digo mÃ­nimo
3. **Refactor**: Melhorar sem quebrar

### **Cobertura MÃ­nima**
- **Unit Tests**: 90% cobertura
- **Integration**: Todos os fluxos crÃ­ticos
- **E2E**: CenÃ¡rios principais

### **Test Structure**
```typescript
describe('FeatureName', () => {
  describe('when condition', () => {
    it('should expected behavior', () => {
      // Arrange
      // Act
      // Assert
    });
  });
});
```

## ğŸ” Code Review Rules

### **PR Checklist AutomÃ¡tico**
- [ ] CÃ³digo segue padrÃµes de nomenclatura
- [ ] Testes cobrem novas funcionalidades
- [ ] DocumentaÃ§Ã£o atualizada
- [ ] Sem warnings do TypeScript
- [ ] Complexidade ciclomÃ¡tica < 10
- [ ] DuplicaÃ§Ã£o < 3%

### **Severidade de Issues**
- **CRITICAL**: Falha de seguranÃ§a ou quebra de contrato
- **HIGH**: Performance ou manutenibilidade comprometida
- **MEDIUM**: ViolaÃ§Ã£o de padrÃµes mas funcional
- **LOW**: Estilo ou melhorias cosmÃ©ticas

## ğŸ”„ RefatoraÃ§Ã£o Guidelines

### **Quando Refatorar**
1. **Tamanho**: Arquivo > 600 linhas
2. **Complexidade**: FunÃ§Ã£o > 20 linhas ou > 4 nÃ­veis de aninhamento
3. **DuplicaÃ§Ã£o**: CÃ³digo repetido > 2 vezes
4. **Acoplamento**: Mais de 3 dependÃªncias diretas

### **Processo de RefatoraÃ§Ã£o**
```typescript
// Passo 1: Identificar smells
class LargeClass { /* 800+ lines */ }

// Passo 2: Extrair responsabilidades
class ValidationService { }
class DataProcessor { }
class ReportGenerator { }

// Passo 3: Criar interfaces
interface IValidator {
  validate(data: unknown): ValidationResult;
}
```

### **Safe Refactoring**
1. **Criar testes** antes de alterar
2. **Refatorar em pequenos passos**
3. **Rodar testes** apÃ³s cada mudanÃ§a
4. **Commit granular** com mensagens claras

## ğŸ“Š MÃ©tricas de Qualidade

### **MÃ©tricas Monitoradas**
- **Lines of Code**: MÃ¡ximo 600 por arquivo
- **Cyclomatic Complexity**: MÃ¡ximo 10 por funÃ§Ã£o
- **Test Coverage**: MÃ­nimo 90%
- **Duplication**: MÃ¡ximo 3%
- **Technical Debt**: Monitorado via SonarQube

### **Alertas AutomÃ¡ticos**
```json
{
  "file_size_warning": "> 400 lines",
  "file_size_error": "> 600 lines",
  "complexity_warning": "> 8",
  "complexity_error": "> 10",
  "coverage_warning": "< 85%",
  "coverage_error": "< 90%"
}
```

## ğŸ¨ Estilo de CÃ³digo

### **TypeScript Style Guide**
```typescript
// âœ… Nomenclatura
const MAX_RETRY_ATTEMPTS = 3;
const userRepository: IUserRepository;
const calculateTotalPrice = (items: Item[]): number => { };

// âœ… Interfaces prefixadas
interface IValidationService { }
interface IBrowserAgent { }

// âœ… Enums descritivos
enum ValidationStatus {
  PENDING = 'PENDING',
  VALID = 'VALID',
  INVALID = 'INVALID'
}
```

### **OrganizaÃ§Ã£o de Arquivos**
```
src/
â”œâ”€â”€ feature-name/
â”‚   â”œâ”€â”€ index.ts           # Public API
â”‚   â”œâ”€â”€ feature.service.ts # LÃ³gica de negÃ³cio
â”‚   â”œâ”€â”€ feature.dto.ts     # Data transfer objects
â”‚   â”œâ”€â”€ feature.test.ts    # Testes unitÃ¡rios
â”‚   â””â”€â”€ types.ts          # Tipos especÃ­ficos
```

## ğŸš€ Performance Guidelines

### **OtimizaÃ§Ãµes AutomÃ¡ticas**
- **Lazy loading** para mÃ³dulos grandes
- **Memoization** para funÃ§Ãµes puras
- **Connection pooling** para recursos externos
- **Caching** com TTL apropriado

### **Anti-patterns Proibidos**
```typescript
// âŒ Nesting profundo
if (condition1) {
  if (condition2) {
    if (condition3) {
      // ... 4+ nÃ­veis
    }
  }
}

// âœ… Early returns
if (!condition1) return;
if (!condition2) return;
// LÃ³gica principal
```

## ğŸ“ DocumentaÃ§Ã£o

### **JSDoc ObrigatÃ³rio**
```typescript
/**
 * Valida dados CSV contra interface web
 * @param config - ConfiguraÃ§Ã£o de validaÃ§Ã£o
 * @returns Resultado com evidÃªncias e relatÃ³rios
 * @throws {ValidationError} Quando configuraÃ§Ã£o Ã© invÃ¡lida
 * @example
 * ```typescript
 * const result = await validateData({
 *   input: 'data.csv',
 *   urlTemplate: 'https://example.com/{id}'
 * });
 * ```
 */
async function validateData(config: ValidationConfig): Promise<ValidationResult> { }
```

### **README.md por MÃ³dulo**
Cada mÃ³dulo deve conter:
- PropÃ³sito e responsabilidade
- Como usar (exemplos)
- DependÃªncias
- Como testar

## ğŸ”§ Ferramentas & IntegraÃ§Ã£o

### **Cursor Commands**
```bash
# RefatoraÃ§Ã£o automÃ¡tica
cursor:refactor # Analisa e sugere refatoraÃ§Ãµes
cursor:test     # Gera testes para cÃ³digo novo
cursor:docs     # Atualiza documentaÃ§Ã£o

# Qualidade
cursor:lint     # Executa linting completo
cursor:analyze  # AnÃ¡lise de complexidade
cursor:coverage # RelatÃ³rio de cobertura
```

### **VSCode Tasks**
```json
{
  "label": "quality-check",
  "type": "npm",
  "script": "quality:check",
  "problemMatcher": ["$tsc", "$eslint"]
}
```

## ğŸ¯ Comandos de Qualidade

### **Pre-commit Hooks**
```bash
# Executa automaticamente
npm run lint:fix          # ESLint auto-fix
npm run test:staged       # Testes afetados
npm run type-check        # TypeScript strict
npm run complexity:check  # AnÃ¡lise de complexidade
```

### **CI/CD Gates**
- **Build**: Deve compilar sem erros
- **Tests**: Todos passando com 90%+ cobertura
- **Lint**: Zero warnings
- **Security**: Scan sem vulnerabilidades
- **Performance**: Sem regressÃµes > 5%

## ğŸš¨ Erros Comuns & SoluÃ§Ãµes

### **TypeScript Errors**
```typescript
// âŒ Any types
const data: any = getData();

// âœ… Type safety
const data = getData() as ValidationResult;
```

### **Memory Leaks**
```typescript
// âŒ Sem cleanup
class BrowserAgent {
  private browser: Browser;
}

// âœ… Cleanup apropriado
class BrowserAgent {
  private browser: Browser;
  
  async dispose(): Promise<void> {
    await this.browser?.close();
  }
}
```

## ğŸ”„ Continuous Improvement

### **Sprint Retrospectiva**
- Revisar mÃ©tricas de qualidade
- Identificar padrÃµes problemÃ¡ticos
- Atualizar estas regras
- Compartilhar aprendizados

### **Knowledge Base**
- PadrÃµes comuns documentados
- SoluÃ§Ãµes para problemas recorrentes
- Exemplos de refatoraÃ§Ã£o bem-sucedida

---

**ğŸ’¡ Lembre-se**: Estas regras evoluem com o projeto. Proponha melhorias via PR quando identificar oportunidades.
