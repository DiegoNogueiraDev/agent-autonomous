# BUG-003: Modo tolerante rejeitado apesar de configuração adequada

## 📋 Informações Básicas
- **ID:** BUG-003
- **Data:** 2025-07-21
- **Severidade:** High
- **Status:** Open

## 🔍 Descrição
Mesmo utilizando a flag `--tolerant` e tendo dados corrompidos que são esperados em testes de robustez, o sistema rejeita o arquivo inteiro quando a taxa de erro excede 10%. O threshold de erro não pode ser configurado adequadamente via linha de comando.

## 📂 Massa de Dados
- **Arquivo:** data/input/corrupted-test.csv
- **Problemas identificados:**
  - Linha 2: `João"Silva` (aspas não fechadas)
  - Linha 6: `"5","Charlie"Wilson"` (aspas mal formatadas)
  - Linha 7: Campo faltando (status)
  - Linha 8: Coluna extra
  - Linha 9: Idade inválida
  - Linha 10: Email vazio

## 🔄 Passos para Reproduzir
1. Executar: `npm run dev validate -- --input data/input/corrupted-test.csv --config config/sample-validation.yaml --output tests/test-corrupted-tc005 --verbose --max-rows 10 --tolerant`
2. Sistema detecta 5 erros em 15 linhas (33.3%)
3. Falha com: "Taxa de erro muito alta: 33.3% (máximo permitido: 10.0%)"

## 📋 Resultado Esperado
- Modo tolerante deveria processar dados mesmo com alta taxa de erro
- `--error-threshold` deveria permitir configurar limite personalizado
- Sistema deveria continuar processamento com as linhas válidas

## ❌ Resultado Atual
- Rejeição total do arquivo
- Não respeita configuração de tolerância
- Threshold fixo em 10% não configurável via CLI

## 📝 Logs/Evidências
```
⚠️ Encontrados 5 erros de parsing (33.3% das linhas)

[31merror[39m: Validation process failed {"error":"Failed to load CSV file: Taxa de erro muito alta: 33.3% (máximo permitido: 10.0%)"}
```

## 💡 Possíveis Causas
1. **Flag --tolerant não implementada:** Parâmetro pode ser ignorado
2. **--error-threshold não funciona:** Opção pode não estar sendo aplicada
3. **Validação hardcoded:** Limite de 10% pode estar fixo no código
4. **Ordem de validação:** Verificação pode acontecer antes da aplicação das flags

## 🔧 Solução Proposta
1. **Imediata:** Verificar se flags --tolerant e --error-threshold estão sendo aplicadas
2. **Correção:** Implementar configuração dinâmica do threshold via CLI
3. **Melhoria:** Permitir processamento parcial mesmo com alta taxa de erro

## 📊 Impacto
- **Funcionalidade:** Crítica - impede teste de robustez com dados problemáticos
- **Usabilidade:** Alta - usuários não conseguem processar dados do mundo real
- **Flexibilidade:** Alta - sistema muito rígido para cenários reais

## 🎯 Teste de Verificação
Tentar: `npm run dev validate -- --input data/input/corrupted-test.csv --config config/sample-validation.yaml --tolerant --error-threshold 0.5`