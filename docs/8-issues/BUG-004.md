# BUG-004: Extração de dados falha completamente em site complexo

## 📋 Informações Básicas
- **ID:** BUG-004
- **Data:** 2025-07-21
- **Severidade:** High
- **Status:** Open

## 🔍 Descrição
Ao testar com dados de caracteres especiais no site Emojipedia, a extração de dados falha completamente (0 extrações bem-sucedidas em todas as tentativas), mesmo com navegação bem-sucedida. Isso indica problemas na capacidade de extrair dados de sites com estruturas complexas.

## 📂 Massa de Dados
- **Arquivo:** data/special-chars-test.csv
- **Site alvo:** https://emojipedia.org/search?q={searchTerm}
- **Características:** Site com JavaScript complexo, emojis e Unicode

## 🔄 Passos para Reproduzir
1. Executar: `npm run dev validate -- --input data/special-chars-test.csv --config config/special-chars-test.yaml --output tests/test-special-chars-tc013 --verbose --max-rows 5`
2. Observar navegação bem-sucedida para todos os 5 URLs
3. Notar que todas as extrações retornam 0 sucessos

## 📋 Resultado Esperado
- Extração de dados deve funcionar em sites modernos
- Pelo menos alguns campos devem ser extraídos com sucesso
- Sistema deve adaptar-se a estruturas de DOM complexas

## ❌ Resultado Atual
- **Navegação:** ✅ 100% de sucesso
- **Extrações:** ❌ 0% de sucesso em todos os casos
- **Validações LLM:** Não executadas (sem dados para validar)

## 📝 Logs/Evidências
```
[32minfo[39m: Navigation completed {"loadTime":2276,"redirectCount":1,"service":"datahawk","status":200,"timestamp":"2025-07-21T01:35:17.428Z","url":"https://emojipedia.org/search?q=heart"}
[32minfo[39m: Data extraction completed {"extractedFields":4,"service":"datahawk","successfulExtractions":0,"timestamp":"2025-07-21T01:35:19.674Z"}

[32minfo[39m: Navigation completed {"loadTime":1720,"redirectCount":15,"service":"datahawk","status":200,"timestamp":"2025-07-21T01:35:21.395Z","url":"https://emojipedia.org/search?q=smile"}
[32minfo[39m: Data extraction completed {"extractedFields":4,"service":"datahawk","successfulExtractions":0,"timestamp":"2025-07-21T01:35:22.034Z"}

// Padrão se repete para todos os 5 testes
```

## 💡 Possíveis Causas
1. **Seletores inadequados:** Configuração pode não corresponder à estrutura real do site
2. **Conteúdo carregado via JavaScript:** DOM pode não estar pronto no momento da extração
3. **Anti-bot protection:** Site pode ter proteções que interferem na extração
4. **Timeout insuficiente:** Conteúdo pode demorar para carregar completamente
5. **Estrutura DOM dinâmica:** Site pode usar componentes React/Vue com estrutura mutável

## 🔧 Solução Proposta
1. **Imediata:** Verificar seletores na configuração special-chars-test.yaml
2. **Intermediária:** Implementar wait conditions para conteúdo JavaScript
3. **Longo prazo:** Melhorar robustez da extração para sites modernos

## 📊 Impacto
- **Funcionalidade:** Crítica - impossibilita teste com sites reais
- **Compatibilidade:** Alta - muitos sites modernos usam JavaScript
- **Confiabilidade:** Alta - zero extrações bem-sucedidas

## 🎯 Investigação Necessária
1. Verificar config/special-chars-test.yaml
2. Testar seletores manualmente no site
3. Analisar estrutura do DOM após carregamento completo
4. Verificar se wait conditions estão adequadas

## 🔗 Relacionado
- Pode estar relacionado ao BUG-001 (problemas LLM) se a extração depende de validação prévia